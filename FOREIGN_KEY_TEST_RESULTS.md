# –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π FOREIGN KEY constraint

**–î–∞—Ç–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:** 2025-10-26 15:01:29  
**–°–∏—Å—Ç–µ–º–∞:** Windows 10, Python 3.10  
**–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:** SQLite (telegram_bot.db)

## ‚úÖ –£–°–ü–ï–®–ù–´–ï –¢–ï–°–¢–´

### 1. –¢–µ—Å—Ç —Å–∏—Å—Ç–µ–º—ã —Ä–∞–Ω–≥–æ–≤ (`test_ranks.py`)
- ‚úÖ –í—Å–µ 27 —Ç–µ—Å—Ç–æ–≤ —Ä–∞—Å—á–µ—Ç–æ–≤ —Ä–∞–Ω–≥–æ–≤ –ø—Ä–æ—à–ª–∏ —É—Å–ø–µ—à–Ω–æ
- ‚úÖ –†–∞–Ω–≥–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å –Ω–æ–≤–æ–π –≤–æ–µ–Ω–Ω–æ–π –∏–µ—Ä–∞—Ä—Ö–∏–µ–π
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏–º–µ—Ä–∞ –∏–∑ TODO (6112 –æ—á–∫–æ–≤ ‚Üí –ö–∞–ø–∏—Ç–∞–Ω) —É—Å–ø–µ—à–Ω–∞

**–í—ã–≤–æ–¥:** –°–∏—Å—Ç–µ–º–∞ —Ä–∞–Ω–≥–æ–≤ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞.

### 2. –ë–∞–∑–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ SQLite –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü –ø—Ä–æ—à–ª–æ —É—Å–ø–µ—à–Ω–æ
- ‚úÖ –í—Å—Ç–∞–≤–∫–∞ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ `user_id` —É—Å–ø–µ—à–Ω–∞
- ‚úÖ FOREIGN KEY constraints –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –≤ —Å—Ö–µ–º–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

**–í—ã–≤–æ–¥:** –ë–∞–∑–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞.

## ‚ö†Ô∏è –ü–†–û–ë–õ–ï–ú–´, –ö–û–¢–û–†–´–ï –ë–´–õ–ò –í–´–Ø–í–õ–ï–ù–´

### 1. –û—Ç–∫–ª—é—á–µ–Ω–Ω—ã–µ FOREIGN KEY constraints –≤ SQLite
- ‚ùå FOREIGN KEY constraints –æ—Ç–∫–ª—é—á–µ–Ω—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤ SQLite
- ‚ùå –¢–µ—Å—Ç—ã –≤—Å—Ç–∞–≤–∫–∏ —Å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ `user_id` –ø—Ä–æ—Ö–æ–¥—è—Ç –±–µ–∑ –æ—à–∏–±–æ–∫
- ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∑–∞—â–∏—Ç–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö

**–†–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
```
FOREIGN KEY –≤–∫–ª—é—á–µ–Ω—ã: 0 (False)
–¢–µ—Å—Ç–∏—Ä—É–µ–º –Ω–∞—Ä—É—à–µ–Ω–∏–µ FOREIGN KEY...
–û–®–ò–ë–ö–ê: –í—Å—Ç–∞–≤–∫–∞ –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ, —Ö–æ—Ç—è –¥–æ–ª–∂–Ω–∞ –±—ã–ª–∞ –ø—Ä–æ–≤–∞–ª–∏—Ç—å—Å—è!
```

### 2. –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—Ö–µ–º —Ç–∞–±–ª–∏—Ü
- ‚ùå –¢–∞–±–ª–∏—Ü–∞ `users` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `telegram_id`, –∞ –Ω–µ `user_id`
- ‚ùå –¢–µ—Å—Ç—ã –º–æ–¥–µ—Ä–∞—Ü–∏–∏ –ø—ã—Ç–∞—é—Ç—Å—è —Ä–∞–±–æ—Ç–∞—Ç—å —Å –∫–æ–ª–æ–Ω–∫–æ–π `user_id`, –∫–æ—Ç–æ—Ä–∞—è –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- ‚ùå –ú–∏–≥—Ä–∞—Ü–∏—è —Ä–∞–Ω–≥–æ–≤ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–∑-–∑–∞ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –Ω–∞–∑–≤–∞–Ω–∏–π –∫–æ–ª–æ–Ω–æ–∫

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã users:**
```
[(0, 'id', 'INTEGER', 0, None, 1),
 (1, 'telegram_id', 'INTEGER', 1, None, 0),
 (2, 'username', 'TEXT', 0, None, 0),
 (3, 'first_name', 'TEXT', 0, None, 0),
 (4, 'last_name', 'TEXT', 0, None, 0),
 ...]
```

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã warnings:**
```
[(0, 'id', 'INTEGER', 0, None, 1),
 (1, 'user_id', 'INTEGER', 1, None, 0),
 (2, 'reason', 'TEXT', 1, None, 0),
 (3, 'admin_id', 'INTEGER', 1, None, 0),
 (4, 'created_at', 'DATETIME', 0, 'CURRENT_TIMESTAMP', 0)]
```

### 3. –ù–µ–¥–æ—Å—Ç—É–ø–Ω—ã–µ –º–æ–¥—É–ª–∏
- ‚ùå –ú–æ–¥—É–ª—å `bot.py` –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –º–∞—Ç–∞
- ‚ùå –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ç–µ—Å—Ç—ã –º–æ–¥–µ—Ä–∞—Ü–∏–∏ –Ω–µ –º–æ–≥—É—Ç –±—ã—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω—ã

## üîß –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –ü–û –ò–°–ü–†–ê–í–õ–ï–ù–ò–Æ

### 1. –í–∫–ª—é—á–∏—Ç—å FOREIGN KEY constraints
```sql
PRAGMA foreign_keys = ON;
```

### 2. –û–±–µ—Å–ø–µ—á–∏—Ç—å –≤–∫–ª—é—á–µ–Ω–∏–µ FK –≤ –∫–æ–¥–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–ª–∞—Å—Å Database –≤ `database_sqlite.py`:
```python
def connect(self):
    """–£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å SQLite –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö"""
    try:
        self.connection = sqlite3.connect(self.db_file)
        self.connection.execute('PRAGMA foreign_keys = ON')  # –î–û–ë–ê–í–ò–¢–¨ –≠–¢–£ –°–¢–†–û–ö–£
        print(TECH_MESSAGES['db_connected'])
    except sqlite3.Error as error:
        print(TECH_MESSAGES['db_connection_error'].format(error=error))
        self.connection = None
```

### 3. –ò—Å–ø—Ä–∞–≤–∏—Ç—å –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –Ω–∞–∑–≤–∞–Ω–∏–π –∫–æ–ª–æ–Ω–æ–∫
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `telegram_id` –≤–º–µ—Å—Ç–æ `user_id` –≤ —Ç–∞–±–ª–∏—Ü–µ `users`
- –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–¥ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –Ω–∞–∑–≤–∞–Ω–∏—è–º–∏ –∫–æ–ª–æ–Ω–æ–∫

### 4. –û–±–Ω–æ–≤–∏—Ç—å —Ç–µ—Å—Ç—ã –º–æ–¥–µ—Ä–∞—Ü–∏–∏
–ò—Å–ø—Ä–∞–≤–∏—Ç—å `test_moderation.py` –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –Ω–∞–∑–≤–∞–Ω–∏–π –∫–æ–ª–æ–Ω–æ–∫:
- `user_id` ‚Üí `telegram_id` –≤ –∑–∞–ø—Ä–æ—Å–∞—Ö –∫ —Ç–∞–±–ª–∏—Ü–µ `users`
- –û–±–Ω–æ–≤–∏—Ç—å –º–µ—Ç–æ–¥—ã `add_warning`, `get_user_info` –∏ —Ç.–¥.

## üìä –ò–¢–û–ì–û–í–´–ï –†–ï–ó–£–õ–¨–¢–ê–¢–´ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç–∞—Ç—É—Å | –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ |
|-----------|--------|------------|
| –°–∏—Å—Ç–µ–º–∞ —Ä–∞–Ω–≥–æ–≤ | ‚úÖ –†–ê–ë–û–¢–ê–ï–¢ –ö–û–†–†–ï–ö–¢–ù–û | –í—Å–µ 27 —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ–π–¥–µ–Ω—ã |
| –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö | ‚úÖ –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–ï –ò –û–°–ù–û–í–ù–´–ï –û–ü–ï–†–ê–¶–ò–ò –†–ê–ë–û–¢–ê–Æ–¢ | |
| FOREIGN KEY constraints | ‚ùå –ù–£–ñ–î–ê–Æ–¢–°–Ø –í –î–û–†–ê–ë–û–¢–ö–ï | –û—Ç–∫–ª—é—á–µ–Ω—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é |
| –¢–µ—Å—Ç—ã –º–æ–¥–µ—Ä–∞—Ü–∏–∏ | ‚ö†Ô∏è –ß–ê–°–¢–ò–ß–ù–û –†–ê–ë–û–¢–ê–Æ–¢ | –¢—Ä–µ–±—É—é—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞–∑–≤–∞–Ω–∏–π –∫–æ–ª–æ–Ω–æ–∫ |
| –°–∏—Å—Ç–µ–º–∞ —Å–æ–æ–±—â–µ–Ω–∏–π | ‚úÖ –†–ê–ë–û–¢–ê–ï–¢ | –í—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã |
| –°–ø–∏—Å–æ–∫ –∑–∞–ø—Ä–µ—â–µ–Ω–Ω—ã—Ö —Å–ª–æ–≤ | ‚úÖ –ó–ê–ì–†–£–ñ–ï–ù | 54 —Å–ª–æ–≤–∞ |

## üéØ –î–ò–ê–ì–ù–û–ó

**–û—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞:** FOREIGN KEY constraints –æ—Ç–∫–ª—é—á–µ–Ω—ã –≤ SQLite, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤—Å—Ç–∞–≤–ª—è—Ç—å –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ. –≠—Ç–æ –æ—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –æ—à–∏–±–æ–∫ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö.

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:**
1. –í–∫–ª—é—á–∏—Ç—å FOREIGN KEY constraints –≤ –∫–æ–¥–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
2. –ò—Å–ø—Ä–∞–≤–∏—Ç—å –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –Ω–∞–∑–≤–∞–Ω–∏–π –∫–æ–ª–æ–Ω–æ–∫ –≤ —Ç–µ—Å—Ç–∞—Ö
3. –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ –≤—Å—Ç–∞–≤–∫–æ–π

## üìà –°–¢–ê–¢–ò–°–¢–ò–ö–ê –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï–ô –í –ë–ê–ó–ï

- –í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: 4
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å —Ä–µ–ø—É—Ç–∞—Ü–∏–µ–π > 0: 2
- –í—Å–µ–≥–æ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π –≤ –±–∞–∑–µ: 0 (–ø–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö)

**–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å—é:**
- ID: 123456789, –†–µ–ø—É—Ç–∞—Ü–∏—è: 51, –†–∞–Ω–≥: –†—è–¥–æ–≤–æ–π
- ID: 999999999, –†–µ–ø—É—Ç–∞—Ü–∏—è: 2, –†–∞–Ω–≥: –†—è–¥–æ–≤–æ–π